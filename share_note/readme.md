# Index
- [十一月分享主题预览·上](https://github.com/slpi1/public_doc/blob/master/share_note#十一月分享主题预览上)

## 十一月分享主题预览·上
### PSR
- [PSR - PHP 标准规范 中文版](https://github.com/summerblue/psr.phphub.org/tree/master/psrs): 重点关注 `PSR-1/PSR-2/PSR-4` 三条

*扩展*

[composer 的使用](http://docs.phpcomposer.com/)

### 版本管理
- 版本库是根本: 所有有效的修改必须入库, 对线上的即时性修改，也需要补录提交。
- 每次提交后工作目录尽量干净: 过多的未提交的修改记录会干扰同步与提交。
- 版本控制目录，忽略目录与文件: 分清哪些文件是需要进行版本管理的，哪些目录是不需要入库的，避免库中存在无意义文件。
- 重要的提交记录做好提交日志

*扩展*
- `git` 的使用技巧：使用临时仓库对比文件的差异、使用本地仓库管理不同的备份
- `git` 的多人协作开发策略
- `git` 的 `tag` 与版本号及部署

### SDK维护中遇到的一些问题

前提：线上代码备份都是整体备份，更新一般也都是整体更新。

**线上代码更新时需要避开部分目录更新**
- `Application/Common/Conf/config.php`: 该文件包含本地数据库连接信息，不能上传到正式环境
- `Application/Runtime`: 临时文件目录
- `Uploads`: 文件上传目录

*规划项目目录，不同功能的目录处于不同的一级目录。*

**条件检查在不同环境下的差异**
比如在充值成功回调时，会检查当前发起请求的域名，测试服务器与正式服务器域名不一致，导致执行结果不一致
*引入环境变量配置，如tp5的 `.env` 文件*

**多服务器运行，业务需要分离**
`SDK` 的业务可以分成四模块：`Admin/Agent/API/Box`。其中 `Admin/API` 运行在同一个服务器，`Agent/Box` 分别运行在独自的服务器，一共有三台服务器。
遵守整体备份与更新的前提下，更新的成本比较高，第一，需要整体备份并同时更新三台服务器；第二，由于开发进度的影响，不好确定目标版本。对于小更新来说太重了。
如果小更新直接更新到线上，多次叠加会使各个服务器代码版本不一致。

*模块化*

**接口不稳定**
维护中发现第一版SDK接口有些已经不可用。接口包括两层含义，一是对外暴露的 `API` 接口，二是模块之间的方法调用。稳定的基本要求是输入与输出的数据结构稳定。

*API：类1提供了所有有版本1的接口，在接口升级时，新建类2继承类1，在类2中覆盖有变化的接口。*

**新功能相关的问题**
新功能会改变原方法的参数的情况。

**Config表的使用**
- 有具体语境的特定值
- 预计会因运营而变化的值